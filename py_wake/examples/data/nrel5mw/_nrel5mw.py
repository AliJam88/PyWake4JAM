from py_wake import np
from py_wake.wind_turbines.power_ct_functions import PowerCtTabular
from py_wake.wind_turbines._wind_turbines import WindTurbine
power_curve = np.array([[0.00000000e+00, 0.00000000e+00],
                        [2.00000000e+00, 0.00000000e+00],
                        [2.50000000e+00, 0.00000000e+00],
                        [3.00000000e+00, 9.06812420e+01],
                        [3.50000000e+00, 2.33744296e+02],
                        [4.00000000e+00, 4.21268641e+02],
                        [4.50000000e+00, 6.61176929e+02],
                        [5.00000000e+00, 9.57250295e+02],
                        [5.50000000e+00, 1.31855852e+03],
                        [6.00000000e+00, 1.74686031e+03],
                        [6.50000000e+00, 2.24713441e+03],
                        [7.00000000e+00, 2.82181823e+03],
                        [7.50000000e+00, 3.47566183e+03],
                        [8.00000000e+00, 4.21555906e+03],
                        [8.50000000e+00, 5.05566541e+03],
                        [9.00000000e+00, 6.00203908e+03],
                        [9.50000000e+00, 7.05827106e+03],
                        [1.00000000e+01, 8.22084032e+03],
                        [1.05000000e+01, 9.48979688e+03],
                        [1.10000000e+01, 1.08748414e+04],
                        [1.15000000e+01, 1.23469227e+04],
                        [1.20000000e+01, 1.23469351e+04],
                        [1.25000000e+01, 1.23469335e+04],
                        [1.30000000e+01, 1.23469463e+04],
                        [1.35000000e+01, 1.23469440e+04],
                        [1.40000000e+01, 1.23469321e+04],
                        [1.45000000e+01, 1.23469443e+04],
                        [1.50000000e+01, 1.23469397e+04],
                        [1.55000000e+01, 1.23469612e+04],
                        [1.60000000e+01, 1.23469073e+04],
                        [1.65000000e+01, 1.23469569e+04],
                        [1.70000000e+01, 1.23469558e+04],
                        [1.75000000e+01, 1.23469264e+04],
                        [1.80000000e+01, 1.23468821e+04],
                        [1.85000000e+01, 1.23468985e+04],
                        [1.90000000e+01, 1.23469173e+04],
                        [1.95000000e+01, 1.23469981e+04],
                        [2.00000000e+01, 1.23469797e+04],
                        [2.05000000e+01, 1.23470023e+04],
                        [2.10000000e+01, 1.23468027e+04],
                        [2.15000000e+01, 1.23470260e+04],
                        [2.20000000e+01, 1.23468596e+04],
                        [2.25000000e+01, 1.23469715e+04],
                        [2.30000000e+01, 1.23470948e+04],
                        [2.35000000e+01, 1.23471091e+04],
                        [2.40000000e+01, 1.23467721e+04],
                        [2.45000000e+01, 1.23469660e+04],
                        [2.50000000e+01, 1.23469703e+04],
                        [2.50100000e+01, 1.16487030e+04],
                        [2.50200000e+01, 0.00000000e+00],
                        [5.00000000e+01, 0.00000000e+00]])

ct_curve = np.array([[0., 0.],
                  [2., 0.],
                  [2.5, 0.],
                  [3., 0.99],
                  [3.5, 0.99],
                  [4., 0.97373036],
                  [4.5, 0.92826162],
                  [5., 0.89210543],
                  [5.5, 0.86100905],
                  [6., 0.835423],
                  [6.5, 0.81237673],
                  [7., 0.79225789],
                  [7.5, 0.77584769],
                  [8., 0.7629228],
                  [8.5, 0.76156073],
                  [9., 0.76261984],
                  [9.5, 0.76169723],
                  [10., 0.75232027],
                  [10.5, 0.74026851],
                  [11., 0.72987175],
                  [11.5, 0.70701647],
                  [12., 0.54054532],
                  [12.5, 0.45509459],
                  [13., 0.39343381],
                  [13.5, 0.34250785],
                  [14., 0.30487242],
                  [14.5, 0.27164979],
                  [15., 0.24361964],
                  [15.5, 0.21973831],
                  [16., 0.19918151],
                  [16.5, 0.18131868],
                  [17., 0.16537679],
                  [17.5, 0.15103727],
                  [18., 0.13998636],
                  [18.5, 0.1289037],
                  [19., 0.11970413],
                  [19.5, 0.11087113],
                  [20., 0.10339901],
                  [20.5, 0.09617888],
                  [21., 0.09009926],
                  [21.5, 0.08395078],
                  [22., 0.0791188],
                  [22.5, 0.07448356],
                  [23., 0.07050731],
                  [23.5, 0.06684119],
                  [24., 0.06345518],
                  [24.5, 0.06032267],
                  [25., 0.05741999],
                  [25.01, 0.05472609],
                  [25.02, 0.],
                  [50., 0.]])


class NREL5MW(WindTurbine):
    '''
    Data from:
    https://www.nrel.gov/docs/fy09osti/38060.pdf
    J. Jonkman, S. Butterfield, W. Musial, and G. Scott
    "Definition of a 5-MW Reference Wind Turbine for Offshore
    System Development", February 2009
    '''

    def __init__(self, method='linear'):
        u, p = power_curve.T
        WindTurbine.__init__(
            self,
            'NREL5MW',
            diameter=126.0,
            hub_height=90.0,
            powerCtFunction=PowerCtTabular(u, p * 1000, 'w',
                                           ct_curve[:, 1],
                                           ws_cutin=3, ws_cutout=25,
                                           method=method))


NREL5MW_RWT = NREL5MW


def main():
    wt = NREL5MW()
    print('Diameter', wt.diameter())
    print('Hub height', wt.hub_height())
    ws = np.arange(3, 25)
    import matplotlib.pyplot as plt
    plt.plot(ws, wt.power(ws), '.-', label='power [W]')
    c = plt.plot([], label='ct')[0].get_color()
    plt.legend()
    ax = plt.twinx()
    ax.plot(ws, wt.ct(ws), '.-', color=c)
    plt.show()


if __name__ == '__main__':
    main()
