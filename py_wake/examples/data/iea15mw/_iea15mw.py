from py_wake import np
from py_wake.wind_turbines.power_ct_functions import PowerCtTabular
from py_wake.wind_turbines._wind_turbines import WindTurbine
power_curve = np.array([[0.00000000e+00, 0.00000000e+00],
                        [3.00000000e+00, 4.75136406e+01],
                        [3.50000000e+00, 2.04687473e+02],
                        [4.00000000e+00, 4.03318176e+02],
                        [4.50000000e+00, 6.53945242e+02],
                        [4.75000000e+00, 8.03180562e+02],
                        [5.00000000e+00, 9.68638975e+02],
                        [5.25000000e+00, 1.14896551e+03],
                        [6.00000000e+00, 1.80053835e+03],
                        [6.20000000e+00, 2.00427992e+03],
                        [6.40000000e+00, 2.22013979e+03],
                        [6.50000000e+00, 2.33345688e+03],
                        [6.55000000e+00, 2.39132496e+03],
                        [6.60000000e+00, 2.45013995e+03],
                        [6.70000000e+00, 2.56961547e+03],
                        [6.80000000e+00, 2.69179498e+03],
                        [6.90000000e+00, 2.81676634e+03],
                        [6.92000000e+00, 2.84201847e+03],
                        [6.93000000e+00, 2.85473377e+03],
                        [6.94000000e+00, 2.86729888e+03],
                        [6.95000000e+00, 2.87990135e+03],
                        [6.96000000e+00, 2.89241406e+03],
                        [6.97000000e+00, 2.90502700e+03],
                        [6.98000000e+00, 2.91761278e+03],
                        [6.99000000e+00, 2.93010623e+03],
                        [7.00000000e+00, 2.94276448e+03],
                        [7.50000000e+00, 3.61994900e+03],
                        [8.00000000e+00, 4.39356704e+03],
                        [8.50000000e+00, 5.27026808e+03],
                        [9.00000000e+00, 6.25609677e+03],
                        [9.50000000e+00, 7.35794080e+03],
                        [1.00000000e+01, 8.58231718e+03],
                        [1.02500000e+01, 9.24343548e+03],
                        [1.05000000e+01, 9.93619653e+03],
                        [1.06000000e+01, 1.02093680e+04],
                        [1.07000000e+01, 1.02093652e+04],
                        [1.07200000e+01, 1.02093813e+04],
                        [1.07400000e+01, 1.02093660e+04],
                        [1.07600000e+01, 1.02093696e+04],
                        [1.07800000e+01, 1.02093729e+04],
                        [1.07840000e+01, 1.02093653e+04],
                        [1.07860000e+01, 1.02093670e+04],
                        [1.07870000e+01, 1.02093663e+04],
                        [1.07880000e+01, 1.02093645e+04],
                        [1.07890000e+01, 1.02093854e+04],
                        [1.07900000e+01, 1.02108030e+04],
                        [1.08000000e+01, 1.02093798e+04],
                        [1.09000000e+01, 1.02093655e+04],
                        [1.10000000e+01, 1.02093683e+04],
                        [1.12500000e+01, 1.02093822e+04],
                        [1.15000000e+01, 1.02093740e+04],
                        [1.17500000e+01, 1.02093658e+04],
                        [1.20000000e+01, 1.02093620e+04],
                        [1.30000000e+01, 1.02093685e+04],
                        [1.40000000e+01, 1.02093978e+04],
                        [1.50000000e+01, 1.02093732e+04],
                        [1.75000000e+01, 1.02094083e+04],
                        [2.00000000e+01, 1.02093874e+04],
                        [2.25000000e+01, 1.02093016e+04],
                        [2.50100000e+01, 1.02092475e+04],
                        [2.50200000e+01, 0.00000000e+00],
                        [5.00000000e+01, 0.00000000e+00]])

ct_curve = np.array([[0.00000e+00, 0.00000e+00],
                  [3.00000e+00, 8.19749e-01],
                  [3.50000e+00, 8.01112e-01],
                  [4.00000e+00, 8.08268e-01],
                  [4.50000e+00, 8.21911e-01],
                  [4.75000e+00, 8.22876e-01],
                  [5.00000e+00, 8.23266e-01],
                  [5.25000e+00, 8.30989e-01],
                  [6.00000e+00, 8.34932e-01],
                  [6.20000e+00, 8.33619e-01],
                  [6.40000e+00, 8.31805e-01],
                  [6.50000e+00, 8.29011e-01],
                  [6.55000e+00, 8.26909e-01],
                  [6.60000e+00, 8.24741e-01],
                  [6.70000e+00, 8.20430e-01],
                  [6.80000e+00, 8.16176e-01],
                  [6.90000e+00, 8.11200e-01],
                  [6.92000e+00, 8.09741e-01],
                  [6.93000e+00, 8.08781e-01],
                  [6.94000e+00, 8.08102e-01],
                  [6.95000e+00, 8.07567e-01],
                  [6.96000e+00, 8.07252e-01],
                  [6.97000e+00, 8.06624e-01],
                  [6.98000e+00, 8.06496e-01],
                  [6.99000e+00, 8.06806e-01],
                  [7.00000e+00, 8.06651e-01],
                  [7.50000e+00, 8.05470e-01],
                  [8.00000e+00, 8.04572e-01],
                  [8.50000e+00, 8.03949e-01],
                  [9.00000e+00, 8.03905e-01],
                  [9.50000e+00, 8.03709e-01],
                  [1.00000e+01, 8.03452e-01],
                  [1.02500e+01, 8.01706e-01],
                  [1.05000e+01, 8.01777e-01],
                  [1.06000e+01, 7.68658e-01],
                  [1.07000e+01, 7.07315e-01],
                  [1.07200e+01, 6.98508e-01],
                  [1.07400e+01, 6.90212e-01],
                  [1.07600e+01, 6.82336e-01],
                  [1.07800e+01, 6.74836e-01],
                  [1.07840e+01, 6.73371e-01],
                  [1.07860e+01, 6.72646e-01],
                  [1.07870e+01, 6.72283e-01],
                  [1.07880e+01, 6.71922e-01],
                  [1.07890e+01, 6.71564e-01],
                  [1.07900e+01, 6.71387e-01],
                  [1.08000e+01, 6.67640e-01],
                  [1.09000e+01, 6.35292e-01],
                  [1.10000e+01, 6.07278e-01],
                  [1.12500e+01, 5.48966e-01],
                  [1.15000e+01, 5.01379e-01],
                  [1.17500e+01, 4.60983e-01],
                  [1.20000e+01, 4.25966e-01],
                  [1.30000e+01, 3.21166e-01],
                  [1.40000e+01, 2.51102e-01],
                  [1.50000e+01, 2.01415e-01],
                  [1.75000e+01, 1.25654e-01],
                  [2.00000e+01, 8.50670e-02],
                  [2.25000e+01, 6.10260e-02],
                  [2.50100e+01, 4.58150e-02],
                  [2.50200e+01, 0.00000e+00],
                  [5.00000e+01, 0.00000e+00]])


class IEA15MW(WindTurbine):
    '''
    Data from:
    https://www.nrel.gov/docs/fy20osti/75698.pdf
    Evan Gaertner, Jennifer Rinker, Latha Sethuraman,
    Frederik Zahle, Benjamin Anderson, Garrett Barter,
    Nikhar Abbas, Fanzhong Meng, Pietro Bortolotti,
    Witold Skrzypinski, George Scott, Roland Feil,
    Henrik Bredmose, Katherine Dykes, Matt Shields,
    Christopher Allen, and Anthony Viselli
    "Definition of the IEA 15-Megawatt
    Offshore Reference Wind Turbine", March 2020
    '''

    def __init__(self, method='linear'):
        u, p = power_curve.T
        WindTurbine.__init__(
            self,
            'IEA15MW',
            diameter=240.0,
            hub_height=150,
            powerCtFunction=PowerCtTabular(u, p * 1000, 'w',
                                           ct_curve[:, 1],
                                           ws_cutin=3, ws_cutout=25,
                                           method=method))


IEA15WM_RWT = IEA15MW


def main():
    wt = IEA15MW()
    print('Diameter', wt.diameter())
    print('Hub height', wt.hub_height())
    ws = np.arange(3, 25)
    import matplotlib.pyplot as plt
    plt.plot(ws, wt.power(ws), '.-', label='power [W]')
    c = plt.plot([], label='ct')[0].get_color()
    plt.legend()
    ax = plt.twinx()
    ax.plot(ws, wt.ct(ws), '.-', color=c)
    plt.show()


if __name__ == '__main__':
    main()
